# AGENTS.md

## 목적
이 문서는 이 저장소에서 Codex가 작업할 때 따라야 할
**최상위 공통 지침(헌법)**입니다.

실제 역할별 상세 규칙과 작업 방식은 `agents/` 디렉터리의
각 역할별 AGENTS 파일을 기준으로 합니다.

---

## 역할 선택 가이드
요청하는 작업의 성격에 따라 **아래 역할 기준을 따른다**.

- **설계 / 구조 결정 / 기술 선택**
  → `agents/architect/AGENTS.md`

- **기능 생성 / 수정 / 리팩토링 / 코드 작성**
  → `agents/refactorer/AGENTS.md`

- **테스트 작성 / 테스트 실패 분석 / 검증**
  → `agents/tester/AGENTS.md`

- **버그 분석 / 원인 규명 / 최소 수정 제안**
  → `agents/debugger/AGENTS.md`

- **문서 작성 / 변경 기록 / 운영 가이드**
  → `agents/documenter/AGENTS.md`

작업을 시작하기 전, 반드시 해당 역할의 AGENTS 파일을 우선 읽고 따른다.

---

## 프로젝트 구조 규칙

이 프로젝트의 디렉터리/레이어 구조는 아래 문서를 단일 기준으로 한다.

- `docs/project-structure.md`

코드를 작성하거나 파일을 생성·이동하는 모든 역할은
해당 문서의 규칙을 반드시 따른다.

---

### 전역 절대 규칙 (모든 역할 공통)

아래 규칙은 **어떤 역할에서도 예외 없이 적용된다**.
- 

### 성능 & 사용자 경험 (최우선)
- 서비스 성능을 항상 최우선으로 고려한다.
- 사용자 경험(UX)을 해치지 않는다.
  - 체감 속도, 응답성, 로딩/전환 지연, 인터랙션 지연을 악화시키는 변경은 허용하지 않는다.
  - 성능/UX에 영향을 줄 수 있는 변경은 반드시 근거와 완화 전략을 포함한다.

### 안전
- 저장소 루트 밖으로 파일을 작성하거나 수정하지 않는다.
- 파괴적 명령은 명시적으로 요청된 경우에만 수행한다.

### 환경 / 보안
- 비밀 값은 코드에 하드코딩하지 않는다.
- 예제/더미 DSN 값을 실제 설정으로 복사해 사용하지 않는다.
- Sentry DSN은 반드시 환경 변수(`SENTRY_DSN`)로만 주입한다.

### 테스트 / 네트워크
- 테스트에서 실제 네트워크 호출은 금지하며 반드시 mock/stub/fake를 사용한다.

---

## 테스트 전략 (전역)

이 프로젝트는 **테스트 주도 개발(TDD)**을 기본 개발 방식으로 한다.

공식적으로 유지·작성하는 테스트 범위는 다음 두 가지로 한정한다.

- **단위 테스트(Unit Tests)**
  - 핵심 로직, 도메인 규칙, 서비스 단위 검증
- **E2E 테스트**
  - 사용자 관점의 핵심 플로우 검증

다음 테스트 유형은 기본 전략에 포함하지 않는다.
- 세분화된 통합 테스트
- 계약 테스트
- 중복 시나리오 테스트

테스트는 “많음”보다 **의미 있고 유지 가능한 최소 범위**를 우선한다.

---

## 문서화 정책 (요약)
- 모든 변경을 문서화하지 않는다.
- **핵심 사용자 플로우 / 도메인 규칙 / 운영·보안·계약 변경**이 있을 때만 문서를 생성 또는 갱신한다.
- 같은 주제에 대해 여러 문서를 만들지 않고, **단일 문서(Single Source of Truth)**를 유지한다.

---

## 도구 / 워크플로우 기본값
- 패키지 관리는 bun 우선.
- JS/TS 변경이 있을 경우 관련 테스트를 반드시 실행한다. (예: `bun test`)
- `.env.example` ⇄ `.env.local` 은 항상 동기화한다.

---

## 우선순위 규칙
지침이 충돌할 경우 우선순위는 다음과 같다.

1. 이 파일 (`AGENTS.md`)
2. 해당 작업에 선택된 역할의 `agents/AGENTS.*.md`
4. 기타 문서

---

## 마지막 원칙
이 저장소에서의 모든 작업은  
**“기능 추가”보다 “사용자 경험과 신뢰성”을 우선한다.**